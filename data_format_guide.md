# 输入数据格式详解 📊

## 📋 核心数据结构：Te 变量

### 🎯 基本格式
```
Te 是一个 N×2 的二维数组/矩阵：

Te = [时间1    信号值1
      时间2    信号值2  
      时间3    信号值3
      ...      ...
      时间N    信号值N]
```

### 📐 具体结构说明

| 列索引 | 内容 | 单位 | 说明 |
|-------|------|------|------|
| Te(:,1) | 时间数据 | 秒(s) | 测量的时间点序列 |
| Te(:,2) | 信号数据 | 任意单位* | 对应时间点的信号幅值 |

*信号单位可能是：电压(V)、电流(A)、声压(Pa)、位移等

### 🔢 数据示例

#### MATLAB格式示例：
```matlab
% Te 变量内容示例
Te = [
    0.000000    0.125000
    0.000001    0.128000  
    0.000002    0.131000
    0.000003    0.127000
    0.000004    0.123000
    ...         ...
    0.999998    0.002000
    0.999999    0.001000
    1.000000    0.000000
];

% 在 shipin.m 中的使用：
% 第6行：y=interp1(Te(:,1),Te(:,2),tt,'linear');
%        使用Te的第1列作为原始时间轴
%        使用Te的第2列作为原始信号值
%        进行线性插值到新的时间轴tt
```

## 📁 支持的数据格式

### 🔸 格式1：MATLAB .mat 文件 (推荐)
```python
# 文件结构
data样例.mat
├── Te (变量名)
│   ├── 维度: N × 2
│   ├── 类型: double
│   └── 内容: [时间列, 信号列]

# Python加载方法
from scipy.io import loadmat
mat_data = loadmat('data样例.mat')
te_data = mat_data['Te']  # 获取Te变量
```

### 🔸 格式2：分离的NumPy数组
```python
import numpy as np

# 时间数组 (1维)
time_array = np.array([0.0, 0.000001, 0.000002, ...])

# 信号数组 (1维) 
signal_array = np.array([0.125, 0.128, 0.131, ...])

# 使用方法
analyzer.load_data_from_arrays(time_array, signal_array)
```

### 🔸 格式3：CSV文件
```csv
Time_s,Signal
0.000000,0.125000
0.000001,0.128000
0.000002,0.131000
...
```

### 🔸 格式4：文本文件
```
# 制表符分隔
Time(s)	Signal
0.000000	0.125000
0.000001	0.128000
0.000002	0.131000
```

## 🎵 实际数据来源

### 🏛️ 古戏台声学测量数据
基于您的项目背景，Te数据来源于：

1. **测量设备**：
   - XL2 声学分析仪
   - Minirator MR-PRO 信号发生器  
   - M4260 精密测量传声器

2. **测量信号**：
   - 扫频正弦波 (50Hz - 4000Hz)
   - 脉冲响应信号
   - 白噪声或粉红噪声

3. **测量场景**：
   - 古戏台不同位置的声学响应
   - 不同声源位置的对比测量
   - 时间域的脉冲响应记录

### 📊 数据特征

#### 典型的时间范围：
- **短时测量**: 0.1 - 2 秒 (脉冲响应)
- **长时测量**: 1 - 10 秒 (扫频测试)

#### 典型的采样率：
- **MATLAB代码默认**: 1 MHz (Ts = 1×10⁻⁶ 秒)
- **音频测量常用**: 44.1 kHz 或 48 kHz
- **专业声学**: 96 kHz 或更高

#### 信号幅值范围：
- 归一化信号: -1.0 ~ +1.0
- 电压信号: -10V ~ +10V  
- 声压级: 可转换为dB值

## 🔄 数据预处理流程

### 在 MATLAB 代码中：
```matlab
% 1. 线性插值到统一时间轴
tt = 0:Ts:1;  % 新的时间轴
y = interp1(Te(:,1), Te(:,2), tt, 'linear');

% 2. 去除直流分量
y = y - mean(y);
```

### 在 Python 代码中：
```python
# 1. 线性插值
tt = np.arange(0, 1 + sampling_step, sampling_step)
signal_data = np.interp(tt, te_data[:, 0], te_data[:, 1])

# 2. 去除直流分量  
signal_data = signal_data - np.mean(signal_data)
```

## 🗂️ 项目中的实际数据

### data/ 目录结构：
```
data/
├── S1R1/, S1R2/, S1R3/  (第一个声源位置)
├── S2R4/, S2R5/, S2R6/  (第二个声源位置)
│   ├── record1.wav      (第一次录音)
│   ├── record2.wav      (第二次录音) 
│   ├── record3.wav      (第三次录音)
│   └── 混响时间.txt      (分析结果)
└── data样例.mat         (MATLAB格式的示例数据)
```

### 混响时间.txt 格式：
```
频率	50Hz	63Hz	80Hz	100Hz	...
第1次	3.01	168.19	17.10	1.54	...
第2次	77.14	71.13	1.32	0.60	...  
第3次	382.71	9.67	0.90	0.29	...
平均	154.3	83.0	6.4	0.8	...
```

## ⚠️ 重要注意事项

### 1. 数据完整性
- Te数组不能包含NaN或无穷大值
- 时间序列必须是单调递增的
- 信号数据应该是有限值

### 2. 时间轴要求
- 时间从0开始或接近0
- 时间间隔可以不均匀（插值会处理）
- 总时长建议≥1秒以获得足够的频率分辨率

### 3. 信号质量
- 信噪比建议≥20dB
- 避免削波失真
- 确保包含感兴趣的频率成分

### 4. 文件大小考虑
- 高采样率会产生大文件
- 建议根据分析需求选择合适的采样率
- 1MHz采样率，1秒数据约4MB（double精度）

## 🚀 快速开始

### 检查您的数据格式：
```python
# 方法1：检查.mat文件
from scipy.io import loadmat
data = loadmat('data样例.mat')
print("变量列表:", list(data.keys()))
if 'Te' in data:
    print("Te形状:", data['Te'].shape)
    print("Te前5行:", data['Te'][:5])

# 方法2：从WAV文件创建Te格式
import librosa
signal, sr = librosa.load('data/S1R1/record1.wav')
time_array = np.arange(len(signal)) / sr
te_data = np.column_stack((time_array, signal))
print("从WAV创建的Te形状:", te_data.shape)
```

这就是输入数据的完整格式说明！核心就是一个简单的 N×2 矩阵：时间列 + 信号列。
