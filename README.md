# soundwave-analysis-py
soundwave-analysis-py

# 古戏台声学效应研究中的声学数据处理与分析方法报告

## 1. 引言

本报告旨在系统性地梳理与总结《平遥超山庙古戏台声学效应初探》与《平遥真武庙“开字形”后台设洞古戏台声学效应初探》两篇论文中所采用的声学数据处理与分析方法。这两项研究的共同目标是，通过现代声学测量技术，科学地揭示古戏台特定建筑结构（窑洞）的声学功能，并论证其与中国戏曲音乐之间的内在联系。本报告将详细阐述从实验设计、数据采集、信号处理、特征提取到最终关联分析的全过程。

## 2. 第一阶段：实验设计与数据采集

此阶段的目标是精确、可靠地捕获古戏台建筑的声学响应特性。

#### **2.1 测量仪器**

两项研究均采用了专业级的声学测量设备，以确保数据的准确性：

- **核心分析设备**: 瑞士NTi Audio AG公司生产的 **XL2 声学分析仪**，用于实时频谱分析和数据记录。
- **声源**: 使用 **Minirator MR-PRO 信号发生器** 产生测试音频信号。在“真武庙”研究中，为获得更大的声能，还辅助使用了丹麦B&K公司的 **功率放大器** 和 **全向声源**。
- **拾音设备**: 使用 **M4260 精密测量传声器** 捕捉空间中的声音信号。

#### **2.2 测试信号**

为了全面评估戏台在不同频率下的声学表现，研究中使用了**扫频正弦波信号**。该信号能覆盖从低频到高频的宽广范围（例如50Hz 至 4000Hz 或 50Hz 至 6500Hz），这与戏曲表演中的人声和乐器频率范围高度相关。

#### **2.3 测量布局（关键方法差异）**

两项研究在测量布局上因研究侧重点不同而有所差异：

- **超山庙研究 (聚焦共振特性)**:
  - **目标**: 探究“十字窑洞”本身的共振物理特性。
  - **布局**: 将声源与测量传声器均设置在**窑洞内部**的不同测点。这种布局旨在直接、纯粹地测量该窑洞结构受声音激发时产生的共振频率点。
- **真武庙研究 (聚焦扩声效果)**:
  - **目标**: 量化“开字形”窑洞对戏台表演的实际扩声增益效果。
  - **布局**: 采用了**对比实验法**。
    1. **实验组**: 将声源放置在**后台窑洞内**，模拟演员在后台发声。
    2. **对照组**: 将声源放置在**前台表演区**。
    3. **接收点**: 两种情况下，测量传声器始终放置在**观众席区域**。
  - 通过对比两组实验在观众席接收到的声音数据，可以直接评估窑洞的扩声能力。

## 3. 第二阶段：原始数据处理与特征提取

此阶段的核心是将采集到的原始声波信号转化为可供分析的量化数据。

#### **3.1 核心处理技术：快速傅里叶变换 (FFT)**

两项研究都运用了声学分析的黄金标准——**快速傅里叶变换 (FFT) 频谱分析**。

1. XL2分析仪将传声器采集到的**时域信号**（声压随时间变化）输入。
2. 通过内置的FFT算法，将其转换为**频域信号**（声压级随频率变化）。
3. 输出结果为一张**频谱图**，该图直观地展示了在测试频段内，每个频率点对应的声音强度（声压级，单位dB）。

#### **3.2 关键特征提取：共振峰 (Resonance Peaks)**

在频谱图上，研究人员重点关注那些能量显著集中的**波峰**，即**共振峰**。这些峰值点代表了该建筑结构最容易发生共振并对声音产生放大效应的频率。

对每一个识别出的共振峰，提取两个核心数据：

1. **中心频率 (Hz)**: 共振峰顶点所对应的精确频率值。
2. **峰值声压级 (dB)**: 该共振频率上测得的最大声音强度。

## 4. 第三阶段：数据关联分析与音乐学阐释

此阶段是整个研究的精髓，它将抽象的物理声学数据与具体的音乐声学理论联系起来。

#### **4.1 分析方法一：共振频率与标准音高比对**

这是两篇论文中最核心的分析步骤，旨在验证共振现象是否与音乐相关。

- **比对基准**: 将第二阶段提取出的所有**共振峰中心频率 (Hz)**，与国际标准的**十二平均律**音高频率表进行逐一比对。
- **量化指标**: 计算**频率偏差值**。即，将实测共振频率与十二平均律中最接近它的那个乐音的标准频率进行相减，得到一个差值（Hz）。
- **分析逻辑**: 如果偏差值普遍很小（例如在5-8Hz以内），则强烈表明这些共振频率并非随机出现，而是建筑被有意设计或“调校”以匹配特定的音乐音高。

#### **4.2 分析方法二：声压级增益分析**

此方法用于评估共振效应的实际扩声强度。

- **超山庙研究**: 通过对比**共振峰的峰值声压级**与频谱上的**平均声压级**，来评估相对增益。
- **真武庙研究 (更为精确)**: 直接对比两种实验条件下（声源在后台 vs. 在前台）在**同一共振频率**上测得的峰值声压级。两者之差即为窑洞在该频率点上带来的**净增益值 (dB)**。例如，报告中指出最大增益可达27.1dB，这是一个非常强有力的量化证据。

#### **4.3 分析方法三：音乐结构与调式分析**

在将共振频率成功识别为一系列乐音（如F、G、B、c、d…）后，研究人员对这些乐音集合进行音乐学分析。

- 他们分析这些共振音高是否能构成中国戏曲音乐中常见的**音阶**（如五声音阶、七声音阶）。
- 同时，分析这些音高之间是否存在和谐的**音程关系**（如八度、五度等），这些关系是构成音乐和声的基础。

## 5. 第四阶段：数据可视化

为了清晰地呈现分析结果，研究中采用了多种图表：

- **频谱图**: 用于展示原始FFT分析结果和共振峰的识别。
- **柱状图**: 用于直观对比不同条件下的声压级强度，尤其在真武庙研究中，清晰地展示了后台窑洞的扩声效果。
- **折线图/散点图**: 用于展示共振峰值在整个频段内的分布趋势。
- **频率偏差图**: 将实测频率与标准音高的偏差进行可视化，直观展示两者吻合度。

## 6. 结论

综合两篇论文，其数据处理与分析流程展现了一个严谨的跨学科研究范式。该流程始于精确的**物理声学测量**，通过**FFT信号处理**提取出关键的**共振频率特征**，再通过与**音乐律学理论**的定量比对（计算频率偏差和声压级增益），最终将物理现象与文化艺术（戏曲音乐）紧密联系起来。这一整套方法论成功地将原始、复杂的声波数据，转化为关于古代建筑声学智慧的、具有说服力的科学结论。

---

## 7. Python 信号分析工具使用说明

本项目提供了Python版本的信号分析工具，用于复现和扩展上述声学分析方法。

### 7.1 环境要求

- Python 3.7 或更高版本
- 必要的科学计算库（见 requirements.txt）

### 7.2 安装依赖

```bash
pip install -r requirements.txt
```

### 7.3 功能特性

Python版本的信号分析工具 (`signal_analysis.py`) 提供以下核心功能：

1. **时域分析**: 信号的时间域可视化与处理
2. **频域分析**: FFT频谱分析，识别共振峰
3. **相位分析**: 相位-频率关系分析
4. **时频分析**: 谱图分析，观察信号的时频特性

### 7.4 使用方法

#### 基本使用示例

```python
from signal_analysis import SignalAnalyzer
import numpy as np

# 创建分析器实例
analyzer = SignalAnalyzer()

# 方法1: 从MATLAB .mat文件加载数据
analyzer.load_data_from_mat('data样例.mat', 'Te')

# 方法2: 从数组直接加载数据
time_data = np.linspace(0, 1, 1000)
signal_data = np.sin(2 * np.pi * 100 * time_data)  # 100Hz正弦波
analyzer.load_data_from_arrays(time_data, signal_data)

# 执行完整分析
analyzer.analyze_all()
```

#### 单独绘制图形

```python
# 绘制时域图
analyzer.plot_time_domain()

# 绘制频域图
analyzer.plot_frequency_domain(freq_limit=4000)

# 绘制相位图
analyzer.plot_phase_domain()

# 绘制时频图
analyzer.plot_spectrogram(freq_limit=600)
```

### 7.5 数据格式要求

#### MATLAB数据格式
- `.mat` 文件中应包含变量 `Te`（或指定的变量名）
- `Te` 应为 N×2 矩阵，第一列为时间数据，第二列为信号数据

#### Python数组格式
- 时间数组: 1维numpy数组，表示采样时间点
- 信号数组: 1维numpy数组，表示对应时间点的信号幅值

### 7.6 配置参数

主要可调参数：

- `sampling_step`: 采样步长（默认 1e-6 秒）
- `freq_limit`: 频率显示上限（默认 4000Hz）
- `nfft`: FFT长度（默认 40000）

### 7.7 输出结果

工具将生成4个图形窗口：

1. **Figure 1**: 时域图 - 显示信号随时间的变化
2. **Figure 2**: 频域图 - 显示FFT频谱，可识别共振峰
3. **Figure 3**: 相位图 - 显示相位随频率的变化
4. **Figure 4**: 时频图 - 显示信号的时频特性

### 7.8 与原MATLAB代码的对应关系

| MATLAB功能 | Python方法 | 说明 |
|-----------|------------|------|
| 时域图绘制 | `plot_time_domain()` | 对应 figure(1) |
| 频域FFT分析 | `plot_frequency_domain()` | 对应 figure(2) |
| 相位分析 | `plot_phase_domain()` | 对应 figure(3) |
| 时频谱图 | `plot_spectrogram()` | 对应 figure(4) |
| 数据插值 | `_process_te_data()` | 对应 interp1() |
| 去直流分量 | 自动处理 | 对应 y-mean(y) |

### 7.9 扩展应用

该工具可用于：

- 古建筑声学测量数据分析
- 共振频率识别与音乐律学对比
- 声学增益效果量化分析
- 戏曲音乐频谱特征研究

### 7.10 注意事项

1. 确保数据文件路径正确
2. 图表标签和标题使用英文，符合国际学术规范
3. 所有函数均包含详细的中文注释说明
4. 支持类型注解，提高代码可维护性
