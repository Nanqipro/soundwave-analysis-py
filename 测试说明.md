# 参数功能测试说明

## 📋 测试概述

为了验证声学分析工具的参数调节功能是否正常工作，我们提供了三个测试脚本来全面检验系统的各项功能。

## 🧪 测试脚本说明

### 1. `run_tests.py` - 主测试运行器 ⭐ **推荐使用**

**用途**：一站式测试运行器，提供三种测试模式

**使用方法**：
```bash
python run_tests.py
```

**测试模式**：
- **快速测试**：验证基本参数配置功能（1-2分钟）
- **完整测试**：包括实际音频文件分析（5-10分钟）  
- **全部测试**：运行所有测试项目（10-15分钟）

**优点**：
- 自动检查测试环境
- 提供交互式选择
- 生成详细测试报告
- 适合首次验证

### 2. `test_streamlit_parameters.py` - Streamlit参数传递测试

**用途**：专门测试前端参数配置是否能正确传递给后端

**使用方法**：
```bash
python test_streamlit_parameters.py
```

**测试内容**：
- 预设配置功能
- 参数范围验证
- 配置与分析器集成
- 窗函数选项测试

**输出**：生成 `streamlit_parameter_test_report_YYYYMMDD_HHMMSS.json`

### 3. `test_parameter_functionality.py` - 完整参数功能测试

**用途**：使用实际音频文件测试参数变化对分析结果的影响

**使用方法**：
```bash
python test_parameter_functionality.py
```

**测试内容**：
- 8种不同参数配置
- 实际音频分析
- 结果差异对比
- 性能指标统计

**输出**：
- 测试结果图表和数据
- 保存在 `test_results/` 目录
- 生成对比分析图

## 🚀 快速开始

### 第一次测试（推荐）

```bash
# 1. 运行主测试脚本
python run_tests.py

# 2. 选择 "1" 进行快速测试
# 这将验证基本的参数配置功能
```

### 验证WAV文件分析功能

```bash
# 确保在data/目录中有WAV文件，然后运行：
python run_tests.py

# 选择 "2" 进行完整测试
# 这将使用实际音频文件验证参数影响
```

## 📊 测试结果解读

### 成功标志
- ✅ **预设配置正常**：5种预设配置能正确应用
- ✅ **参数传递正确**：前端参数能传递给后端分析器
- ✅ **结果有差异**：不同参数产生不同的分析结果
- ✅ **通过率 > 80%**：大部分测试通过

### 验证要点

#### 1. 频率分辨率参数
**期望结果**：
- 高分辨率设置（0.001Hz）→ 更多频率点，更精细分析
- 低分辨率设置（0.1Hz）→ 更少频率点，更快处理

#### 2. 共振峰检测参数
**期望结果**：
- 敏感检测（低阈值）→ 检测到更多峰值
- 严格检测（高阈值）→ 检测到更少但更显著的峰值

#### 3. 窗函数影响
**期望结果**：
- 不同窗函数（hann, hamming, blackman）→ 主导峰值位置或强度有细微差异

#### 4. 频率范围控制
**期望结果**：
- 扩展频率范围（8000Hz vs 2000Hz）→ 分析更多高频成分

## 🔍 测试故障排除

### 常见问题

#### 1. "未找到WAV测试文件"
**解决方案**：
```bash
# 在以下任一目录放置WAV文件
mkdir -p data
# 将WAV文件复制到data/目录
```

#### 2. "无法导入必要模块"
**解决方案**：
```bash
# 确保在正确目录运行
ls -la  # 应该看到streamlit_app.py和wav_to_spectrum_analyzer.py

# 安装依赖
pip install -r requirements_web.txt
```

#### 3. "分析失败"
**解决方案**：
- 检查WAV文件格式是否正确
- 确保文件不超过50MB
- 验证文件没有损坏

#### 4. "参数没有影响"
**可能原因**：
- 参数变化太小，差异不明显
- 测试音频文件特性单一
- 需要检查代码中参数传递逻辑

### 调试模式

如果测试失败，可以逐步检查：

```bash
# 1. 先测试基础导入
python -c "from wav_to_spectrum_analyzer import SpectrumAnalyzer; print('导入成功')"

# 2. 测试Streamlit应用导入
python -c "from streamlit_app import apply_preset_configuration; print('Streamlit导入成功')"

# 3. 检查具体错误
python test_streamlit_parameters.py  # 查看详细错误信息
```

## 📈 进阶测试

### 自定义测试配置

如果想测试特定参数组合，可以修改 `test_parameter_functionality.py` 中的 `generate_test_configurations()` 方法：

```python
# 添加自定义测试配置
"custom_test": {
    "name": "自定义配置",
    "target_freq_resolution": 0.005,  # 自定义值
    "max_freq": 3000,                 # 自定义值
    "window_type": "hamming",
    "min_prominence": 4.0,
    "min_distance": 15.0,
    "max_peaks": 25,
    "min_height": None
}
```

### 性能基准测试

```bash
# 测试不同配置的处理时间
time python test_parameter_functionality.py

# 比较快速分析vs高精度分析的时间差异
```

## 📝 测试报告文件

测试完成后会生成以下文件：

### 快速测试
- `streamlit_parameter_test_report_YYYYMMDD_HHMMSS.json`
- `test_summary_YYYYMMDD_HHMMSS.txt`

### 完整测试  
- `test_results/` 目录
  - `test_results_YYYYMMDD_HHMMSS.json` - 详细测试数据
  - `test_summary_YYYYMMDD_HHMMSS.csv` - 测试结果摘要
  - `parameter_comparison_YYYYMMDD_HHMMSS.png` - 对比图表
  - `test_report_YYYYMMDD_HHMMSS.txt` - 文本报告
  - 各种参数配置的分析图片

## 🎯 测试成功的标准

**参数调节功能正常的标志**：

1. **预设配置生效** ✅
   - 建筑声学配置：频率分辨率0.01Hz，最大频率2000Hz
   - 语音分析配置：频率分辨率0.1Hz，最大频率8000Hz
   - 音乐分析配置：频率分辨率0.05Hz，最大频率20000Hz

2. **参数影响明显** ✅
   - 高分辨率vs低分辨率：频率点数差异显著（10倍以上）
   - 敏感vs严格检测：共振峰数量差异明显（2倍以上）
   - 不同窗函数：分析结果有细微但可检测的差异

3. **前端后端一致** ✅
   - Streamlit界面设置的参数能正确传递给分析器
   - 配置显示与实际使用的参数一致

4. **错误处理正常** ✅
   - 无效参数值能被正确处理
   - 系统不会因参数问题崩溃

---

**🎉 如果所有测试通过，说明参数调节功能完全正常，可以放心使用！**
