# WAV频谱分析器参数配置指南

## 概述

本文档详细列出了 `wav_to_spectrum_analyzer.py` 中所有可调节的参数，帮助用户根据不同的分析需求进行配置。

## 核心分析器参数

### SpectrumAnalyzer 初始化参数

| 参数名 | 类型 | 默认值 | 说明 | 调节建议 |
|--------|------|--------|------|----------|
| `target_freq_resolution` | float | 0.01 | 目标频率分辨率 (Hz) | • 高精度分析：0.01-0.001 Hz<br/>• 快速分析：0.1-1.0 Hz<br/>• 长信号可设更小值 |
| `output_dir` | str | "ana_res" | 输出目录路径 | 根据项目需要自定义路径 |

## 频谱分析参数

### 窗函数配置

| 参数名 | 类型 | 默认值 | 可选值 | 说明 |
|--------|------|--------|--------|------|
| `window_type` | str | 'hann' | 'hann', 'hamming', 'blackman', 'rectangular' | • hann: 通用，较好的频率分辨率<br/>• hamming: 减少旁瓣<br/>• blackman: 最小旁瓣泄漏<br/>• rectangular: 最高频率分辨率 |

### 频率范围控制

| 参数名 | 类型 | 默认值 | 说明 | 使用场景 |
|--------|------|--------|------|----------|
| `max_freq` | float | None | 最大分析频率 (Hz) | • 语音分析：4000-8000 Hz<br/>• 音乐分析：20000 Hz<br/>• 建筑声学：1000-2000 Hz |
| `freq_range` | tuple | None | 频率显示范围 (min_freq, max_freq) | 图表显示控制 |

## 共振峰检测参数

### 检测阈值参数

| 参数名 | 类型 | 默认值 | 说明 | 调节指导 |
|--------|------|--------|------|----------|
| `min_prominence` | float | 6.0 | 最小峰值突出度 (dB) | • 敏感检测：3-5 dB<br/>• 标准检测：6-8 dB<br/>• 严格检测：10-15 dB |
| `min_distance` | float | 10.0 | 相邻峰值最小频率间隔 (Hz) | • 高密度峰值：5-10 Hz<br/>• 标准间隔：10-20 Hz<br/>• 稀疏峰值：30-50 Hz |
| `min_height` | float | None | 峰值最小高度 (dB SPL) | 自动计算或手动设置绝对阈值 |
| `max_peaks` | int | 20 | 最大检测峰值数量 | 根据分析需要调整：10-50 |

## 时频分析参数

### 时频谱图参数

| 参数名 | 类型 | 默认值 | 说明 | 优化建议 |
|--------|------|--------|------|----------|
| `window_length` | int | None | STFT窗长度 | • 高时间分辨率：短窗 (≤512)<br/>• 高频率分辨率：长窗 (≥2048)<br/>• 自动计算：信号长度/10 |
| `overlap_ratio` | float | 0.75 | 窗重叠比例 | • 平滑效果：0.75-0.9<br/>• 快速计算：0.5-0.6 |

## 时域分析参数

### 显示控制参数

| 参数名 | 类型 | 默认值 | 说明 | 应用场景 |
|--------|------|--------|------|----------|
| `max_duration` | float | None | 时域显示最大时长 (秒) | • 长信号预览：1-5 秒<br/>• 详细分析：完整时长 |
| `time_range` | float | 1.0 | 综合分析中时域显示时长 | 根据信号特征调整 |

## 批量分析参数

### 批量处理配置

| 参数名 | 类型 | 默认值 | 说明 | 使用建议 |
|--------|------|--------|------|----------|
| `data_dir` | str | "data" | 数据目录路径 | 修改为实际数据路径 |
| `plot_individual` | bool | True | 是否绘制单独频谱图 | • 详细分析：True<br/>• 批量处理：False |
| `plot_comparison` | bool | False | 是否绘制对比图 | 多文件比较时启用 |
| `comprehensive_analysis` | bool | False | 是否进行综合分析 | • 完整分析：True<br/>• 快速处理：False |

## 图表显示参数

### 保存和显示选项

| 参数名 | 类型 | 默认值 | 说明 | 注意事项 |
|--------|------|--------|------|----------|
| `save_path` | str | None | 图片保存路径 | None时自动生成 |
| `show_plot` | bool | False | 是否显示图片 | • 交互式分析：True<br/>• 批量处理：False |
| `save_prefix` | str | None | 保存文件前缀 | 便于文件管理和识别 |
| `subdir` | str | None | 子目录名称 | 按数据来源组织文件 |

### 显示范围控制

| 参数名 | 类型 | 默认值 | 说明 | 调节目的 |
|--------|------|--------|------|----------|
| `spl_range` | tuple | None | 声压级显示范围 (min_spl, max_spl) | 突出特定强度范围 |

## 高级功能参数

### 文件组织参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `auto_subdir` | bool | True | 自动按数据文件夹创建子目录 |

## 参数配置建议

### 按应用场景配置

#### 1. 建筑声学分析
```python
analyzer = SpectrumAnalyzer(
    target_freq_resolution=0.01,  # 高频率精度
    output_dir="building_acoustics"
)

# 共振峰检测参数
min_prominence = 6.0    # 标准突出度
min_distance = 10.0     # 适中间隔
max_freq = 2000         # 建筑声学常用范围
```

#### 2. 语音信号分析
```python
analyzer = SpectrumAnalyzer(
    target_freq_resolution=0.1,   # 较低精度，提高速度
    output_dir="speech_analysis"
)

# 频率范围
max_freq = 8000          # 语音频率范围
min_prominence = 3.0     # 敏感检测
min_distance = 20.0      # 语音共振峰间隔
```

#### 3. 音乐信号分析
```python
analyzer = SpectrumAnalyzer(
    target_freq_resolution=0.05,  # 平衡精度与速度
    output_dir="music_analysis"
)

# 全频带分析
max_freq = 20000         # 音乐全频段
min_prominence = 8.0     # 严格检测
max_peaks = 30           # 更多峰值
```

#### 4. 快速批量处理
```python
# 批量分析参数
batch_params = {
    'max_freq': 2000,
    'plot_individual': False,      # 节省时间
    'comprehensive_analysis': False, # 仅基础分析
    'plot_comparison': True        # 生成对比图
}
```

### 性能优化建议

#### 提高分析速度
- 减小 `target_freq_resolution`（0.1-1.0 Hz）
- 设置合适的 `max_freq` 限制分析范围
- 关闭不必要的图表生成
- 减少 `max_peaks` 数量

#### 提高分析精度
- 增大 `target_freq_resolution`（0.001-0.01 Hz）
- 使用合适的窗函数
- 调整共振峰检测阈值
- 启用综合分析

### 内存使用优化
- 长信号设置 `max_duration` 限制时域显示
- 批量处理时设置 `show_plot=False`
- 合理设置时频分析窗长度

## 参数验证和错误处理

### 常见参数问题
1. **频率分辨率过高**：可能导致内存不足
2. **共振峰阈值过低**：检测到过多噪声峰
3. **窗长度不当**：影响时频分析质量
4. **路径设置错误**：文件保存失败

### 建议的参数验证
```python
# 频率分辨率检查
if target_freq_resolution < 0.001:
    print("警告：频率分辨率过高，可能影响性能")

# 共振峰参数检查
if min_prominence < 3.0:
    print("警告：突出度阈值过低，可能检测到噪声")

# 内存使用估计
estimated_memory = signal_length * 8 / (1024**2)  # MB
if estimated_memory > 1000:
    print(f"警告：预计内存使用 {estimated_memory:.1f} MB")
```

## 结论

通过合理配置这些参数，可以针对不同的声学分析需求获得最佳的分析结果。建议根据具体应用场景选择合适的参数组合，并在实际使用中根据结果质量进行微调。
